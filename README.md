# devops-netology  
## Шевякин Кирилл  

# Домашнее задание к занятию "7.3. Основы и принцип работы Терраформ"

## Задача 1. Создадим бэкэнд в S3 (необязательно, но крайне желательно).

Если в рамках предыдущего задания у вас уже есть аккаунт AWS, то давайте продолжим знакомство со взаимодействием
терраформа и aws. 

1. Создайте s3 бакет, iam роль и пользователя от которого будет работать терраформ. Можно создать отдельного пользователя,
а можно использовать созданного в рамках предыдущего задания, просто добавьте ему необходимы права, как описано 
[здесь](https://www.terraform.io/docs/backends/types/s3.html).
1. Зарегистрируйте бэкэнд в терраформ проекте как описано по ссылке выше. 

### Ответ  

Создан s3 в яндекс облаке  
![image](https://user-images.githubusercontent.com/93198418/177528706-4ed40ab1-1a9a-4a42-a49e-53cee09c5e1a.png)  
![image](https://user-images.githubusercontent.com/93198418/177528832-470e8ecb-02e6-4159-87bd-a5de5dd65e6c.png)  

## Задача 2. Инициализируем проект и создаем воркспейсы. 

1. Выполните `terraform init`:
    * если был создан бэкэнд в S3, то терраформ создат файл стейтов в S3 и запись в таблице 
dynamodb.
    * иначе будет создан локальный файл со стейтами.  
1. Создайте два воркспейса `stage` и `prod`.
1. В уже созданный `aws_instance` добавьте зависимость типа инстанса от вокспейса, что бы в разных ворскспейсах 
использовались разные `instance_type`.
1. Добавим `count`. Для `stage` должен создаться один экземпляр `ec2`, а для `prod` два. 
1. Создайте рядом еще один `aws_instance`, но теперь определите их количество при помощи `for_each`, а не `count`.
1. Что бы при изменении типа инстанса не возникло ситуации, когда не будет ни одного инстанса добавьте параметр
жизненного цикла `create_before_destroy = true` в один из рессурсов `aws_instance`.
1. При желании поэкспериментируйте с другими параметрами и рессурсами.

В виде результата работы пришлите:
* Вывод команды `terraform workspace list`.
* Вывод команды `terraform plan` для воркспейса `prod`.  

### Ответ  

![image](https://user-images.githubusercontent.com/93198418/177530577-454bfec8-0b57-47cc-8604-4b13413b83c5.png)  
![image](https://user-images.githubusercontent.com/93198418/177538528-ce37fad8-e915-4eb8-bca0-7e5425983907.png)  
![image](https://user-images.githubusercontent.com/93198418/177538662-f5e96b51-e1d9-4234-81e9-22f74e9cc889.png)  
![image](https://user-images.githubusercontent.com/93198418/177538735-a382d665-99a9-4c21-8ef3-9a49dfff3d59.png)  
![image](https://user-images.githubusercontent.com/93198418/177538807-e8d01cc7-7208-45c2-a4fe-e7e774e03adc.png)  
![image](https://user-images.githubusercontent.com/93198418/177538864-0d524860-23a7-4a83-b766-a473bb799763.png)  

Результат:  
![image](https://user-images.githubusercontent.com/93198418/177539665-50c504e8-27d7-4639-99fb-bf549e7c035c.png)  
![image](https://user-images.githubusercontent.com/93198418/177539835-6b4562d2-143d-441b-bc64-73a5bbb1f697.png)  






